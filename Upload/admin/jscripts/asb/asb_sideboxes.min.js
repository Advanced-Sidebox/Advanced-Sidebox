var ASB=(function(a,$){function init(){$(".draggable").draggable({revert:true,});$(".sortable").sortable({connectWith:'.column',update:function(e,ui){var container=$(this);$.ajax({type:'post',url:'index.php',data:{module:'config-asb',action:'xmlhttp',mode:'order',pos:container.prop('id'),data:container.sortable("serialize"),},success:function(response){if(!response){return;}
if(typeof response=='string'&&response.search('value="login"'!=-1)){location.reload(true);}
var ids=response.split(',');$(ids).each(function(i,id){ids[i]=parseInt(id);});removeDivs(ids);},error:function(jqXHR,textStatus,errorThrown){alert(textStatus+"\n\n"+
errorThrown);},});},}).disableSelection();$(".droppable").droppable({accept:'.draggable',hoverClass:'hover',drop:create,});$("a[id^='edit_sidebox_']").click(edit);$('.del_icon').remove();$('.add_box_link').each(function(i,e){e.replaceWith($(e).html());});}
function edit(event){event.preventDefault();loadModal($(this).prop("href")+'&ajax=1');}
function create(e,ui){var pos=($(this).prop("id")=='left_column')?0:1,url='index.php?module=config-asb&action=edit_box&ajax=1&box=0&addon='+ui.draggable.prop("id")+'&pos='+pos;loadModal(url);}
function loadModal(url){$.get(url,function(html){if(!html||html.length==0){return;}
if(typeof html=='string'&&html.search("errors")!=-1&&html.search("login")!=-1){location.reload(true);return;}
$(html).appendTo('body').modal({fadeDuration:250,zIndex:(typeof modal_zindex!=='undefined'?modal_zindex:9999),});});}
function createDiv(id,title,columnId){if(!$("#"+columnId)){return;}
$("#"+columnId).append($('<div/>',{id:'sidebox_'+id,class:'sidebox'}).html(title));}
function updateDiv(id){var sideboxId='#sidebox_'+id;if(!$(sideboxId)){return;}
$(sideboxId).load('index.php',{module:'config-asb',action:'xmlhttp',mode:'build_info',id:id,ajax:'1',});}
function removeDivs(ids){if(ids.length==0){return;}
var i,sideboxId,sidebox;for(i=0;i<ids.length;i++){sideboxId='#sidebox_'+ids[i];if(!$(sideboxId)){continue;}
sidebox=$(sideboxId);sidebox.css({backgroundColor:'#f00',});sidebox.html(lang.deleting_sidebox);sidebox.fadeOut(800,function(){$(this).remove();});}}
$(init);a.sidebox={createDiv:createDiv,updateDiv:updateDiv,};return a;})(ASB||{},jQuery);