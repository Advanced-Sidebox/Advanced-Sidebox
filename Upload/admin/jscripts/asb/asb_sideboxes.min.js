var ASB=(function(a){var columns=['left_column','right_column','trash_column'];function init(){buildColumns();$$("a[id^='edit_sidebox_']").invoke('observe','click',edit);$$('.del_icon').each(function(e){e.remove();});$$('.add_box_link').each(function(e){e.replace(e.innerHTML);});}
function buildColumns(){for(var i=0;i<columns.length;i++){var column=columns[i];buildSortable(column);if(column!='trash_column'){buildDroppable(column);}}}
function buildSortable(id){Sortable.create(id,{tag:'div',dropOnEmpty:true,containment:columns,only:'sidebox',onUpdate:function(dragged,dropped,event){new Ajax.Request('index.php',{method:"post",parameters:{module:'config-asb',action:'xmlhttp',mode:'order',pos:id,data:Sortable.serialize(id)},onSuccess:function(response){removeDivs(response.responseText.split(','));}});}});}
function buildDroppable(id){Droppables.add(id,{accept:'draggable',hoverclass:'hover',onDrop:create});}
function edit(event){Event.stop(event);new a.Modal({type:'ajax',url:this.readAttribute('href')+'&ajax=1'});}
function create(dragged,dropped){var pos=1;if(dropped.id=='left_column'){pos=0;}
new a.Modal({type:'ajax',url:'index.php?module=config-asb&action=edit_box&ajax=1&box=0&addon='+dragged.id+'&pos='+pos});}
function createDiv(id,title,columnId){if(!$(columnId)){return;}
$(columnId).insert(new Element('div',{id:'sidebox_'+id,class:'sidebox'}).update(title));buildColumns();}
function updateDiv(id){var sideboxId='sidebox_'+id;if(!$(sideboxId)){return;}
new Ajax.Updater(sideboxId,'index.php',{method:'get',parameters:{module:'config-asb',action:'xmlhttp',mode:'build_info',id:id},evalScripts:true});}
function removeDivs(ids){if(ids.length==0){return;}
var i,sideboxId,sidebox;for(i=0;i<ids.length;i++){sideboxId='sidebox_'+ids[i];if(!$(sideboxId)){continue;}
sidebox=$(sideboxId);sidebox.style.backgroundColor='#f00';sidebox.innerHTML=lang.deleting_sidebox;sidebox.fade({duration:.8});}}
Event.observe(window,'load',init);a.sidebox={createDiv:createDiv,updateDiv:updateDiv,};return a;})(ASB||{});